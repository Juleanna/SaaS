<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR –∫–æ–¥–∏ —Ç–æ–≤–∞—Ä—ñ–≤</title>
    <style>
        @media print {
            body { margin: 0; padding: 10px; }
            .no-print { display: none !important; }
            .page-break { page-break-after: always; }
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
        }
        
        .qr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .qr-item {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
            background: white;
            break-inside: avoid;
        }
        
        .qr-display {
            width: 100px;
            height: 100px;
            border: 2px solid #000;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            word-break: break-all;
            background: white;
        }
        
        .product-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .product-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .qr-code-text {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: #999;
            margin-top: 5px;
        }
        
        .print-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .print-button:hover {
            background: #218838;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="no-print">
            <button class="print-button" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫—É–≤–∞—Ç–∏ QR –∫–æ–¥–∏</button>
        </div>
        
        <div class="header">
            <h1>QR –∫–æ–¥–∏ —Ç–æ–≤–∞—Ä—ñ–≤</h1>
            <p>–£—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤: {{ products.count }}</p>
        </div>
        
        <div class="qr-grid">
            {% for product in products %}
            <div class="qr-item">
                <div class="product-name">{{ product.name }}</div>
                <div class="product-info">
                    SKU: {{ product.sku|default:"‚Äî" }} | 
                    {% if product.product_type == 'piece' %}–ü–æ—à—Ç—É—á–Ω–∏–π{% else %}–í–∞–≥–æ–≤–∏–π{% endif %}
                </div>
                <div class="qr-display" id="qr-{{ forloop.counter }}"></div>
                <div class="qr-code-text">{{ product.qr_code }}</div>
                <div style="font-size: 10px; color: #999;">
                    –ú–∞–≥–∞–∑–∏–Ω: {{ product.store.name }}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button class="print-button" onclick="window.print()">üñ®Ô∏è –î—Ä—É–∫—É–≤–∞—Ç–∏ QR –∫–æ–¥–∏</button>
            <button class="print-button" onclick="goBack()" style="background: #6c757d; margin-left: 10px;">‚úñÔ∏è –ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    
    <script>
        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è QR –∫–æ–¥—ñ–≤
        document.addEventListener('DOMContentLoaded', function() {
            {% for product in products %}
            try {
                QRCode.toCanvas(document.getElementById('qr-{{ forloop.counter }}'), '{{ product.qr_code }}', {
                    width: 100,
                    height: 100,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó QR –∫–æ–¥—É –¥–ª—è {{ product.name }}:', error);
                document.getElementById('qr-{{ forloop.counter }}').innerHTML = '{{ product.qr_code }}';
            }
            {% endfor %}
        });
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞–∑–∞–¥
        function goBack() {
            // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞–∫—Ä–∏—Ç–∏ –≤—ñ–∫–Ω–æ (–ø—Ä–∞—Ü—é—î —è–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ —á–µ—Ä–µ–∑ window.open)
            if (window.opener) {
                window.close();
            } else {
                // –Ø–∫—â–æ –Ω–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–∫—Ä–∏—Ç–∏, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è –Ω–∞–∑–∞–¥
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    // –Ø–∫—â–æ –Ω–µ–º–∞—î —ñ—Å—Ç–æ—Ä—ñ—ó, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ admin
                    window.location.href = '/admin/products/product/';
                }
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏ –¥—ñ–∞–ª–æ–≥ –¥—Ä—É–∫—É
        window.onload = function() {
            // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó QR –∫–æ–¥—ñ–≤
            setTimeout(function() {
                // window.print();
            }, 1000);
        }
        
        // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                goBack();
            }
        });
    </script>
</body>
</html>